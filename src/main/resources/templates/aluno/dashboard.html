<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout">
<head>
    <meta charset="UTF-8">
    <title>Dashboard do Aluno</title>

    <!-- Bootstrap -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
</head>

<body class="bg-light">

<!-- Header Fragment -->
<div th:replace="~{layout/header :: header}"></div>

<div class="container py-4">

    <h2 class="mb-4">Gerenciar Processos</h2>
    <!-- Sucesso -->
    <div th:if="${success}" id="flash-message-success" class="alert alert-success">
        <span th:text="${success}"></span>
    </div>

    <!-- Erro -->
    <div th:if="${error}" id="flash-message-error" class="alert alert-danger">
        <span th:text="${error}"></span>
    </div>


    <!-- Formul√°rio de cria√ß√£o -->
    <div class="card shadow-sm mb-4">
        <div class="card-body">
            <h5>Cadastrar Novo Processo</h5>

            <form th:action="@{/processo/adicionar}" method="post" th:object="${processo}">
                <div class="mb-3">
                    <label class="form-label">Assunto</label>
                    <select class="form-select" th:field="*{assunto}" required>
                        <option value="" disabled selected>Selecione um assunto</option>

                        <!-- LISTA DE ASSUNTOS DO BANCO -->
                        <option th:each="assunto : ${assuntos}"
                                th:value="${assunto.id}"
                                th:text="${assunto.descricao}">
                        </option>
                    </select>
                </div>

                <div class="mb-3">
                    <label class="form-label">Texto do Requerimento</label>
                    <textarea class="form-control" th:field="*{textoRequerimento}" rows="4" name="textoRequerimento" ></textarea>
                </div>

                <button type="submit" class="btn btn-primary">Enviar Processo</button>
            </form>
        </div>
    </div>

    <!-- Tabela de processos -->
    <div class="card shadow-sm">
        <div class="card-body">
            <h5>Meus Processos</h5>

            <!-- Filtros -->
            <form th:action="@{/processo/listar}" method="get" class="row g-3 mb-3">
                <div class="col-md-4">
                    <label class="form-label">Buscar por Assunto</label>
                    <select class="form-select" name="assunto" th:value="${param.assunto}">
                        <option value="" disabled selected>Selecione um assunto</option>
                        <option th:each="assunto : ${assuntos}"
                        th:value="${assunto.id}"
                        th:text="${assunto.descricao}"
                        th:selected="${#strings.equals(param.assunto, null)}">
                        </option>
                    </select>
                </div>

                <div class="col-md-3">
                    <label class="form-label">Filtrar por Status</label>
                    <select class="form-select" name="status" th:value="${param.status}">
                        <option value="" disabled selected>Selecione um status</option>
                        <option th:each="status : ${listaStatus}"
                                th:value="${status}"
                                th:text="${status}"
                                th:selected="${param.status == st.name()}">
                        </option>
                    </select>
                </div>

                <div class="col-md-3">
                    <label class="form-label">Ordenar por Data</label>
                    <select class="form-select" name="ordenacao" th:value="${param.ordenacao}">
                        <option value="ASC">Mais Antigos</option>
                        <option value="DESC">Mais Recentes</option>
                    </select>
                </div>

                <div class="col-md-2 d-flex align-items-end">
                    <button type="submit" class="btn btn-secondary w-100">Filtrar</button>
                </div>
            </form>

            <!-- Feedback -->
            <div th:if="${processos.size() > 0}" class="alert alert-info">
                üîç <span th:text="${processos.size()}"></span> processos encontrados.
            </div>
            <div th:if="${processos.size() == 0}" class="alert alert-warning">
                üìÇ Nenhum processo encontrado com este filtro.
            </div>

            <table class="table table-striped">
                <thead>
                <tr>
                    <th>N√∫mero</th>
                    <th>Assunto</th>
                    <th>Status</th>
                    <th>Data de Cria√ß√£o</th>
                    <th>A√ß√µes</th>
                </tr>
                </thead>

                <tbody>
                <tr th:each="proc : ${processos}">
                    <td th:text="${proc.numeroProcesso}">N√∫mero</td>
                    <td th:text="${proc.assunto.descricao}">Assunto</td>
                    <td th:text="${proc.status}">Status</td>
                    <td th:text="${#temporals.format(proc.dataCriacao, 'dd/MM/yyyy')}">Data</td>
                    <td>
                        <a th:href="@{/processo/detalhes/{id}(id=${proc.id})}" class="btn btn-sm btn-outline-primary">
                            Detalhes
                        </a>
                    </td>
                </tr>
                </tbody>
            </table>
        </div>
    </div>


</div>

<!-- Footer Fragment -->
<div th:replace="~{layout/footer :: footer}"></div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
<script>
    // Faz o flash desaparecer ap√≥s 3 segundos
    setTimeout(function() {
        const msg = document.getElementById("flash-message-success");
        const err = document.getElementById("flash-message-error");
        if (msg) msg.style.display = "none";
        if (err) err.style.display = "none";
    }, 3000);
</script>

</body>
</html>
