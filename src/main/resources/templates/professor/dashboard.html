<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout">
<head>
    <meta charset="UTF-8">
    <title>Dashboard do Aluno</title>

    <!-- Bootstrap -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
</head>

<body class="bg-light">

<div th:replace="~{layout/header :: header(usuario=${usuario})}"></div>

<div class="container py-4">

    <!-- Abas -->
    <ul class="nav nav-tabs mb-4">
        <li class="nav-item">
            <button class="nav-link active"
                    data-bs-toggle="tab"
                    data-bs-target="#painel-processos"
                    type="button">
                ğŸ“„ Meus Processos
            </button>
        </li>

        <li class="nav-item">
            <button class="nav-link"
                    data-bs-toggle="tab"
                    data-bs-target="#painel-reunioes"
                    type="button">
                ğŸ—“ï¸ ReuniÃµes do Colegiado
            </button>
        </li>
    </ul>

    <!-- ConteÃºdo das abas -->
    <div class="tab-content">

        <!-- Painel Processos -->
        <div class="tab-pane fade show active" id="painel-processos">
            <div th:replace="fragments/painel :: painel"></div>
        </div>

        <!-- Painel ReuniÃµes -->
        <div class="tab-pane fade" id="painel-reunioes">
            <div th:replace="~{fragments/painel-reuniao :: painel-reuniao}"></div>

        </div>

    </div>

</div>

<div th:replace="~{layout/footer :: footer}"></div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
<script>
    // Faz o flash desaparecer apÃ³s 3 segundos
    setTimeout(function() {
        const msg = document.getElementById("flash-message-success");
        const err = document.getElementById("flash-message-error");
        if (msg) msg.style.display = "none";
        if (err) err.style.display = "none";
    }, 3000);


    // PARA TABELA PROCESSOS --------------------------------------------------

    async function carregarTabelaComFiltros(paramsObject) {
        const params = new URLSearchParams(paramsObject).toString();
        try {
            const resp = await fetch('/processo/listar?' + params, {
                method: 'GET',
                headers: {
                    'X-Requested-With': 'XMLHttpRequest'
                }
            });

            if (!resp.ok) {
                console.error('Resposta nÃ£o OK:', resp.status, await resp.text());
                return;
            }

            const html = await resp.text();
            document.getElementById('tabela-container').innerHTML = html;
        } catch (err) {
            console.error('Erro ao carregar tabela via AJAX:', err);
        }
    }

    // quando o botÃ£o for clicado, coleta filtros e chama AJAX
    document.getElementById('btnFiltrar').addEventListener('click', function() {
        const assunto = document.getElementById('filtroAssunto').value || '';
        const status = document.getElementById('filtroStatus').value || '';
        const ordenacao = document.getElementById('filtroOrdenacao').value;

        carregarTabelaComFiltros({ assunto, status, ordenacao });

        document.getElementById('filtroOrdenacao').value = ordenacao;
    });

    // -------------------------------------------------- --------------------------------------------------

    // PARA TABELA REUNIOES

    document.addEventListener("DOMContentLoaded", () => {

        const tabReunioes = document.querySelector('[data-bs-target="#painel-reunioes"]');
        const container = document.getElementById("painel-reunioes");

        let carregado = false;

        tabReunioes.addEventListener("shown.bs.tab", () => {
            if (!carregado) {
                carregarReunioes();
                carregado = true;
            }
        });

        function carregarReunioes(params = "") {
            fetch(`/reuniao/professor/Listar${params}`)
                .then(res => res.text())
                .then(html => container.innerHTML = html);
        }

        document.addEventListener("submit", e => {
            if (e.target.closest("form[formReunioes]")) {
                e.preventDefault();
                const form = e.target;
                const params = new URLSearchParams(new FormData(form)).toString();
                carregarReunioes("?" + params);
            }
        });
    });

</script>



</body>
</html>

